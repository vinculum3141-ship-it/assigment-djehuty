<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Level Statistics Dashboard - 4TU.ResearchData Prototype</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 
                         'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 20px;
        }

        h1 {
            color: #2d3748;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #718096;
            font-size: 1.2em;
        }

        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            margin: 0 5px;
        }

        .badge-existing {
            background: #bee3f8;
            color: #2c5282;
        }

        .badge-new {
            background: #c6f6d5;
            color: #22543d;
        }

        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .section-header {
            margin: 40px 0 20px 0;
            padding: 15px;
            background: #f7fafc;
            border-left: 4px solid #667eea;
            border-radius: 4px;
        }

        .section-header h2 {
            color: #2d3748;
            font-size: 1.5em;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: #f7fafc;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .chart-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 15px;
            text-align: center;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .comparison-section {
            background: #fff5f5;
            border: 2px solid #fc8181;
            border-radius: 12px;
            padding: 30px;
            margin: 40px 0;
        }

        .comparison-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .comparison-header h2 {
            color: #c53030;
            font-size: 1.8em;
            margin-bottom: 10px;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .comparison-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #feb2b2;
        }

        .comparison-item h3 {
            color: #2d3748;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .comparison-item ul {
            list-style-position: inside;
            color: #4a5568;
        }

        .comparison-item li {
            margin-bottom: 8px;
        }

        footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 20px;
            border-top: 2px solid #e2e8f0;
            color: #718096;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .comparison-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä Multi-Level Statistics Dashboard</h1>
            <p class="subtitle">4TU.ResearchData Repository - Faculty Statistics Prototype</p>
            <div style="margin-top: 15px;">
                <span class="badge badge-existing">EXISTING SYSTEM</span>
                <span class="badge badge-new">NEW FEATURE</span>
            </div>
            <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px;">
                <p style="color: #856404; font-weight: 600; margin-bottom: 5px;">‚ö†Ô∏è DEMO DATA NOTICE</p>
                <p style="color: #856404; font-size: 0.9em; margin: 0;">
                    This dashboard displays <strong>mock data for demonstration purposes</strong>. 
                    In production, actual values would be populated after migration of existing datasets 
                    to faculty-level group IDs. Current prototype proves the concept and structure.
                </p>
            </div>
        </header>

        <!-- Statistics Overview -->
        <div class="stats-overview">
            <div class="stat-card">
                <div class="stat-value" id="totalDatasets">0</div>
                <div class="stat-label">Total Datasets</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalInstitutions">0</div>
                <div class="stat-label">Institutions</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalFaculties">0</div>
                <div class="stat-label">Faculties</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="granularityGain">0x</div>
                <div class="stat-label">Granularity Increase</div>
            </div>
        </div>

        <!-- Existing System Section -->
        <div class="section-header">
            <h2><span class="badge badge-existing">EXISTING</span> Institution-Level Statistics (Coarse Granularity)</h2>
        </div>
        <div class="charts-grid">
            <div class="chart-container full-width">
                <div class="chart-title">üìä Datasets by Institution (Current System)</div>
                <canvas id="institutionChart"></canvas>
            </div>
        </div>

        <!-- New Feature Section -->
        <div class="section-header">
            <h2><span class="badge badge-new">NEW FEATURE</span> Faculty-Level Statistics (Fine Granularity)</h2>
        </div>
        <div class="charts-grid">
            <div class="chart-container">
                <div class="chart-title">üìä Top Faculties by Dataset Count</div>
                <canvas id="topFacultiesChart"></canvas>
            </div>
            <div class="chart-container">
                <div class="chart-title">ü•ß Faculty Distribution</div>
                <canvas id="facultyDistributionChart"></canvas>
            </div>
        </div>

        <!-- Hierarchy Visualization -->
        <div class="section-header">
            <h2>üå≥ Hierarchical Relationship: Institution ‚Üí Faculty</h2>
        </div>
        <div class="charts-grid">
            <div class="chart-container full-width">
                <div class="chart-title">üèõÔ∏è TU Delft: Institution Breakdown by Faculty</div>
                <canvas id="hierarchyChart"></canvas>
            </div>
        </div>

        <!-- Comparison Section -->
        <div class="comparison-section">
            <div class="comparison-header">
                <h2>üîç Granularity Comparison: What This Extension Enables</h2>
                <p style="color: #742a2a; margin-top: 10px;">Before vs. After Analysis</p>
            </div>
            <div class="comparison-grid">
                <div class="comparison-item">
                    <h3>
                        <span class="badge badge-existing">BEFORE</span>
                        Institution Level Only
                    </h3>
                    <ul>
                        <li><strong>4 groups</strong> (TU Delft, TU Eindhoven, Utrecht, Twente)</li>
                        <li>Coarse granularity - entire university</li>
                        <li>Cannot distinguish faculty contributions</li>
                        <li>Limited insight for department-level analysis</li>
                        <li>Group ID: 28586 (TU Delft only)</li>
                    </ul>
                </div>
                <div class="comparison-item">
                    <h3>
                        <span class="badge badge-new">AFTER</span>
                        Faculty Level Available
                    </h3>
                    <ul>
                        <li><strong>47+ groups</strong> (institution breakdown by faculty)</li>
                        <li>Fine granularity - faculty-specific insights</li>
                        <li>Track faculty contributions separately</li>
                        <li>Enables department/lab extension pattern</li>
                        <li>Group IDs: 285860001 (EEMCS), 285860002 (AE), etc.</li>
                    </ul>
                </div>
            </div>
        </div>

        <footer>
            <p><strong>Prototype Implementation:</strong> Faculty Statistics Extension for 4TU.ResearchData</p>
            <p style="margin-top: 10px;">Senior Software Developer Role - Interview Demonstration</p>
            <p style="margin-top: 10px; font-size: 0.85em;">
                Data Source: Mock/Sample Data (Production would use Virtuoso Triple Store) | Backend: Python SPARQL Interface | Visualization: Chart.js
            </p>
            <p style="margin-top: 10px; font-size: 0.85em; color: #e53e3e;">
                <strong>Note:</strong> Actual dataset counts would be populated after migration process (Phase 2B - write permissions required)
            </p>
        </footer>
    </div>

    <script>
        // Data will be loaded from dashboard_data.json
        let dashboardData = null;

        // Load data and initialize charts
        async function loadDashboardData() {
            try {
                const response = await fetch('dashboard_data.json');
                dashboardData = await response.json();
                initializeDashboard();
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                // Fallback to sample data for demo
                dashboardData = getSampleData();
                initializeDashboard();
            }
        }

        function getSampleData() {
            // Sample data for demonstration (matches dashboard_data.json)
            // Used as fallback if fetch fails (e.g., when opening as file://)
            return {
                overview: {
                    total_datasets: 9,
                    total_institutions: 4,
                    total_faculties: 3,
                    granularity_multiplier: 11.75
                },
                institutions: [
                    { name: "TU Delft", count: 3, id: 28586 },
                    { name: "TU Eindhoven", count: 1, id: 28589 },
                    { name: "Utrecht University", count: 4, id: 28598 },
                    { name: "University of Twente", count: 1, id: 28592 }
                ],
                faculties: [
                    { name: "Faculty of Electrical Engineering, Mathematics and Computer Science", short_name: "EEMCS", count: 4, institution: "TU Delft", id: 285860001, institution_id: 28586 },
                    { name: "Faculty of Aerospace Engineering", short_name: "AE", count: 3, institution: "TU Delft", id: 285860002, institution_id: 28586 },
                    { name: "Faculty of Applied Sciences", short_name: "AS", count: 2, institution: "TU Delft", id: 285860003, institution_id: 28586 }
                ]
            };
        }

        function initializeDashboard() {
            // Update overview statistics
            document.getElementById('totalDatasets').textContent = dashboardData.overview.total_datasets;
            document.getElementById('totalInstitutions').textContent = dashboardData.overview.total_institutions;
            document.getElementById('totalFaculties').textContent = dashboardData.overview.total_faculties;
            document.getElementById('granularityGain').textContent = 
                dashboardData.overview.granularity_multiplier.toFixed(1) + 'x';

            // Create charts
            createInstitutionChart();
            createTopFacultiesChart();
            createFacultyDistributionChart();
            createHierarchyChart();
        }

        function createInstitutionChart() {
            const ctx = document.getElementById('institutionChart');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dashboardData.institutions.map(i => i.name),
                    datasets: [{
                        label: 'Datasets',
                        data: dashboardData.institutions.map(i => i.count),
                        backgroundColor: 'rgba(102, 126, 234, 0.6)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Current System: 4 Institution Groups',
                            font: { size: 14 }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Datasets'
                            }
                        }
                    }
                }
            });
        }

        function createTopFacultiesChart() {
            const ctx = document.getElementById('topFacultiesChart');
            // Sort faculties by count and take top 10
            const sortedFaculties = [...dashboardData.faculties].sort((a, b) => b.count - a.count).slice(0, 10);
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedFaculties.map(f => f.short_name),
                    datasets: [{
                        label: 'Datasets',
                        data: sortedFaculties.map(f => f.count),
                        backgroundColor: 'rgba(72, 187, 120, 0.6)',
                        borderColor: 'rgba(72, 187, 120, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'New Feature: Faculty-Level Breakdown',
                            font: { size: 14 }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Datasets'
                            }
                        }
                    }
                }
            });
        }

        function createFacultyDistributionChart() {
            const ctx = document.getElementById('facultyDistributionChart');
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: dashboardData.faculties.map(f => f.short_name),
                    datasets: [{
                        data: dashboardData.faculties.map(f => f.count || 1), // Use 1 as minimum for visibility
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.6)',
                            'rgba(54, 162, 235, 0.6)',
                            'rgba(255, 206, 86, 0.6)',
                            'rgba(75, 192, 192, 0.6)',
                            'rgba(153, 102, 255, 0.6)',
                            'rgba(255, 159, 64, 0.6)',
                            'rgba(199, 199, 199, 0.6)',
                            'rgba(83, 102, 255, 0.6)',
                            'rgba(255, 99, 255, 0.6)',
                            'rgba(99, 255, 132, 0.6)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right'
                        },
                        title: {
                            display: true,
                            text: 'Faculty Contribution Distribution',
                            font: { size: 14 }
                        }
                    }
                }
            });
        }

        function createHierarchyChart() {
            const ctx = document.getElementById('hierarchyChart');
            // Filter faculties for TU Delft (institution_id: 28586)
            const tuDelftFaculties = dashboardData.faculties.filter(f => f.institution === "TU Delft");
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: tuDelftFaculties.map(f => f.short_name),
                    datasets: [{
                        label: 'Datasets per Faculty',
                        data: tuDelftFaculties.map(f => f.count),
                        backgroundColor: 'rgba(118, 75, 162, 0.6)',
                        borderColor: 'rgba(118, 75, 162, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    indexAxis: 'y', // Horizontal bar chart
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Hierarchical Extension: One Institution ‚Üí Multiple Faculties',
                            font: { size: 14 }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Datasets'
                            }
                        }
                    }
                }
            });
        }

        // Load data when page loads
        window.addEventListener('DOMContentLoaded', loadDashboardData);
    </script>
</body>
</html>
